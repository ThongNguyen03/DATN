@model WebApplication1.Models.GhiChepVi
@{
    ViewBag.Title = "Chi tiết giao dịch ví";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    /* Sidebar styles */
    .seller-sidebar {
        background-color: #ffffff;
        border: 1px solid #e9ecef;
    }

    .seller-sidebar .card-header {
        background-color: #f8f9fa;
        color: #212529;
        border-bottom: 1px solid #e9ecef;
    }

    .seller-sidebar .list-group-item {
        background-color: transparent;
        color: #212529;
        border-color: #e9ecef;
    }

    .seller-sidebar .list-group-item:hover {
        background-color: #f8f9fa;
    }

    .seller-sidebar .list-group-item.active {
        background-color: #007bff;
        border-color: #007bff;
        color: #ffffff;
    }

    /* Transaction detail card */
    .transaction-detail-card {
        background-color: #ffffff;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        overflow: hidden;
    }

    .transaction-header {
        padding: 25px;
        position: relative;
    }

    .header-deposit {
        background: linear-gradient(135deg, #28a745, #20c997);
        color: white;
    }

    .header-withdraw {
        background: linear-gradient(135deg, #dc3545, #fd7e14);
        color: white;
    }

    .header-escrow {
        background: linear-gradient(135deg, #17a2b8, #0dcaf0);
        color: white;
    }

    .header-refund {
        background: linear-gradient(135deg, #ffc107, #ffda8a);
        color: #212529;
    }

    .header-default {
        background: linear-gradient(135deg, #6c757d, #adb5bd);
        color: white;
    }

    .transaction-title {
        font-size: 1.4rem;
        font-weight: 700;
        color: inherit;
        margin-bottom: 10px;
    }

    .transaction-id {
        font-size: 0.9rem;
        color: inherit;
        opacity: 0.9;
        margin-bottom: 5px;
    }

    .transaction-date {
        font-size: 0.9rem;
        color: inherit;
        opacity: 0.9;
    }

    .transaction-status {
        position: absolute;
        top: 25px;
        right: 25px;
        padding: 8px 15px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.85rem;
    }

    .status-success {
        background-color: rgba(255, 255, 255, 0.2);
        color: white;
    }

    .status-pending {
        background-color: rgba(255, 255, 255, 0.2);
        color: white;
    }

    .status-failed {
        background-color: rgba(255, 255, 255, 0.2);
        color: white;
    }

    .transaction-body {
        padding: 25px;
    }

    .transaction-amount {
        margin-bottom: 30px;
        text-align: center;
    }

    .amount-value {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 5px;
    }

    .amount-positive {
        color: #28a745;
    }

    .amount-negative {
        color: #dc3545;
    }

    .amount-label {
        color: #6c757d;
        font-size: 0.9rem;
    }

    .transaction-info {
        margin-bottom: 20px;
    }

    .info-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: #343a40;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #e9ecef;
    }

    .info-item {
        margin-bottom: 15px;
        display: flex;
    }

    .info-label {
        width: 40%;
        color: #6c757d;
        font-weight: 500;
    }

    .info-value {
        width: 60%;
        font-weight: 600;
        color: #343a40;
    }

    .transaction-notes {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 15px;
        margin-top: 20px;
    }

    .notes-title {
        font-weight: 600;
        margin-bottom: 10px;
        color: #343a40;
    }

    .notes-content {
        color: #6c757d;
    }

    .transaction-footer {
        background-color: #f8f9fa;
        padding: 20px 25px;
        border-top: 1px solid #e9ecef;
    }

    /* Receipt section */
    .receipt-paper {
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        padding: 30px;
        position: relative;
        margin-bottom: 30px;
    }

    .receipt-paper::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 8px;
        background: repeating-linear-gradient(
            45deg,
            #f0f0f0,
            #f0f0f0 10px,
            white 10px,
            white 20px
        );
        border-radius: 8px 8px 0 0;
    }

    .receipt-paper::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 8px;
        background: repeating-linear-gradient(
            45deg,
            #f0f0f0,
            #f0f0f0 10px,
            white 10px,
            white 20px
        );
        border-radius: 0 0 8px 8px;
    }

    .receipt-header {
        text-align: center;
        margin-bottom: 20px;
    }

    .receipt-logo {
        margin-bottom: 15px;
    }

    .receipt-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 5px;
    }

    .receipt-subtitle {
        color: #6c757d;
        margin-bottom: 10px;
    }

    .receipt-date {
        font-size: 0.9rem;
        color: #6c757d;
    }

    .receipt-body {
        margin-bottom: 20px;
    }

    .receipt-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        padding-bottom: 10px;
        border-bottom: 1px dotted #dee2e6;
    }

    .receipt-row:last-child {
        border-bottom: none;
    }

    .receipt-label {
        color: #6c757d;
    }

    .receipt-value {
        font-weight: 500;
    }

    .receipt-total {
        display: flex;
        justify-content: space-between;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 2px solid #dee2e6;
    }

    .total-label {
        font-weight: 700;
    }

    .total-value {
        font-weight: 700;
        font-size: 1.2rem;
    }

    .receipt-footer {
        text-align: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #dee2e6;
    }

    .receipt-barcode {
        margin-bottom: 15px;
    }

    .receipt-message {
        color: #6c757d;
    }

    /* Status cards */
    .status-card {
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 20px;
    }

    .status-card .card-header {
        font-weight: 600;
    }
</style>

<div class="container mt-4">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3">
            <div class="card seller-sidebar">
                <div class="card-header text-black">
                    <h5 class="mb-0">Trang người bán</h5>
                </div>
                <div class="list-group list-group-flush">
                    <a href="@Url.Action("EditSellerProfile", "NguoiDungs")" class="list-group-item list-group-item-action">
                        <i class="fas fa-store mr-2"></i> Thông tin cửa hàng
                    </a>
                    <a href="@Url.Action("QuanLySanPham", "NguoiBans", new { id = Model.MaNguoiBan })" class="list-group-item list-group-item-action">
                        <i class="fas fa-box mr-2"></i> Sản phẩm
                    </a>
                    <a href="@Url.Action("DonHangNguoiMua", "DonHang")" class="list-group-item list-group-item-action">
                        <i class="fas fa-shopping-cart mr-2"></i> Đơn hàng
                    </a>
                    <a href="@Url.Action("GiaoDichNguoiBan", "GiaoDich")" class="list-group-item list-group-item-action">
                        <i class="fas fa-exchange-alt mr-2"></i> Lịch sử giao dịch
                    </a>
                    <a href="@Url.Action("ViNguoiBan", "GiaoDich")" class="list-group-item list-group-item-action active">
                        <i class="fas fa-wallet mr-2"></i> Ví của tôi
                    </a>
                    <a href="@Url.Action("QuanLyDanhGia", "NguoiBans", new { id = Model.MaNguoiBan })" class="list-group-item list-group-item-action ">
                        <i class="fas fa-star mr-2"></i> Đánh giá
                    </a>
                    <a href="@Url.Action("QuanLyTaiKhoan", "NguoiBans",new { id = Model.MaNguoiBan })" class="list-group-item list-group-item-action">
                        <i class="fas fa-chart-line mr-2"></i> Thống kê
                    </a>
                    <a href="@Url.Action("DangXuat", "DangNhap")" class="list-group-item list-group-item-action text-danger">
                        <i class="fas fa-sign-out-alt mr-2"></i> Đăng xuất
                    </a>
                </div>
            </div>
        </div>

        <!-- Main content -->
        <div class="col-md-9">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4 class="mb-0">Chi tiết giao dịch ví</h4>
                <a href="@Url.Action("ViNguoiBan", "GiaoDich")" class="btn btn-outline-primary">
                    <i class="fas fa-arrow-left mr-1"></i> Quay lại
                </a>
            </div>

            <div class="row">
                <div class="col-lg-7">
                    <!-- Chi tiết giao dịch -->
                    <div class="transaction-detail-card mb-4">
                        @{
                            string headerClass = "header-default";
                            string iconClass = "fas fa-exchange-alt";
                            bool isPositive = false;
                            
                            if (Model.LoaiGiaoDich == "Nạp tiền ví" || Model.LoaiGiaoDich == "Giải ngân escrow" || Model.LoaiGiaoDich == "Hoàn tiền rút")
                            {
                                headerClass = "header-deposit";
                                iconClass = "fas fa-arrow-down";
                                isPositive = true;
                            }
                            else if (Model.LoaiGiaoDich == "Rút tiền")
                            {
                                headerClass = "header-withdraw";
                                iconClass = "fas fa-arrow-up";
                                isPositive = false;
                            }
                            else if (Model.LoaiGiaoDich.Contains("escrow") || Model.LoaiGiaoDich.Contains("đặt cọc"))
                            {
                                headerClass = "header-escrow";
                                iconClass = "fas fa-money-check-alt";
                                isPositive = false;
                            }
                            else if (Model.LoaiGiaoDich.Contains("hoàn") || Model.LoaiGiaoDich.Contains("trả"))
                            {
                                headerClass = "header-refund";
                                iconClass = "fas fa-undo";
                                isPositive = true;
                            }
                            
                            string amountClass = isPositive ? "amount-positive" : "amount-negative";
                            string amountPrefix = isPositive ? "+" : "-";
                        }
                        
                        <div class="transaction-header @headerClass">
                            <div class="transaction-title">
                                <i class="@iconClass mr-2"></i> @Model.LoaiGiaoDich
                            </div>
                            <div class="transaction-id">Mã giao dịch: #@Model.MaGhiChep</div>
                            <div class="transaction-date">@Model.NgayGiaoDich.ToString("dd/MM/yyyy HH:mm:ss")</div>
                            
                            <div class="transaction-status status-@(Model.TrangThai.ToLower() == "thành công" ? "success" : (Model.TrangThai.ToLower() == "đang xử lý" ? "pending" : "failed"))">
                                @Model.TrangThai
                            </div>
                        </div>
                        
                        <div class="transaction-body">
                            <div class="transaction-amount">
                                <div class="amount-value @amountClass">
                                    @amountPrefix@string.Format("{0:N0} VNĐ", Math.Abs(Model.SoTien))
                                </div>
                                <div class="amount-label">Số tiền giao dịch</div>
                            </div>
                            
                            <div class="transaction-info">
                                <div class="info-title">Thông tin giao dịch</div>
                                
                                <div class="info-item">
                                    <div class="info-label">Loại giao dịch</div>
                                    <div class="info-value">@Model.LoaiGiaoDich</div>
                                </div>
                                
                                <div class="info-item">
                                    <div class="info-label">Trạng thái</div>
                                    <div class="info-value">@Model.TrangThai</div>
                                </div>
                                
                                <div class="info-item">
                                    <div class="info-label">Thời gian</div>
                                    <div class="info-value">@Model.NgayGiaoDich.ToString("dd/MM/yyyy HH:mm:ss")</div>
                                </div>
                                
                                @*@if (!string.IsNullOrEmpty(Model.))
                                {
                                    <div class="info-item">
                                        <div class="info-label">Phương thức</div>
                                        <div class="info-value">@Model.PhuongThucThanhToan</div>
                                    </div>
                                }
                                
                                @if (Model.LoaiGiaoDich == "Rút tiền" && !string.IsNullOrEmpty(Model.ThongTinTaiKhoan))
                                {
                                    <div class="info-item">
                                        <div class="info-label">Tài khoản nhận</div>
                                        <div class="info-value">@Model.ThongTinTaiKhoan</div>
                                    </div>
                                }*@
                                
                                @if (!string.IsNullOrEmpty(Model.MoTa))
                                {
                                    <div class="transaction-notes">
                                        <div class="notes-title">Ghi chú giao dịch</div>
                                        <div class="notes-content">@Model.MoTa</div>
                                    </div>
                                }
                            </div>
                            
                            @if (Model.DonHang != null)
                            {
                                <div class="transaction-info">
                                    <div class="info-title">Thông tin đơn hàng</div>
                                    
                                    <div class="info-item">
                                        <div class="info-label">Mã đơn hàng</div>
                                        <div class="info-value">#@Model.DonHang.MaDonHang</div>
                                    </div>
                                    
                                    <div class="info-item">
                                        <div class="info-label">Tổng tiền đơn hàng</div>
                                        <div class="info-value">@string.Format("{0:N0} VNĐ", Model.DonHang.TongSoTien)</div>
                                    </div>
                                    
                                    <div class="info-item">
                                        <div class="info-label">Trạng thái đơn hàng</div>
                                        <div class="info-value">@Model.DonHang.TrangThaiDonHang</div>
                                    </div>
                                    
                                    <div class="text-center mt-3">
                                        <a href="@Url.Action("ChiTietDonHang", "DonHang", new { id = Model.DonHang.MaDonHang })" class="btn btn-outline-primary btn-sm">
                                            <i class="fas fa-external-link-alt mr-1"></i> Xem chi tiết đơn hàng
                                        </a>
                                    </div>
                                </div>
                            }
                        </div>
                        
                        <div class="transaction-footer">
                            <div class="row">
                                <div class="col-md-6">
                                    <a href="@Url.Action("ViNguoiBan", "GiaoDich")" class="btn btn-outline-secondary btn-block">
                                        <i class="fas fa-arrow-left mr-1"></i> Quay lại
                                    </a>
                                </div>
                                <div class="col-md-6">
                                    <button class="btn btn-outline-primary btn-block" onclick="window.print();">
                                        <i class="fas fa-print mr-1"></i> In biên lai
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-5">
                    <!-- Biên lai giao dịch -->
                    <div class="receipt-paper">
                        <div class="receipt-header">
                            <div class="receipt-logo">
                                <img src="~/Content/images/medinet-logo.png" alt="Logo" height="40">
                            </div>
                            <div class="receipt-title">Biên lai giao dịch</div>
                            <div class="receipt-subtitle">Mã giao dịch: #@Model.MaGhiChep</div>
                            <div class="receipt-date">@Model.NgayGiaoDich.ToString("dd/MM/yyyy HH:mm:ss")</div>
                        </div>
                        
                        <div class="receipt-body">
                            <div class="receipt-row">
                                <div class="receipt-label">Loại giao dịch</div>
                                <div class="receipt-value">@Model.LoaiGiaoDich</div>
                            </div>
                            
                            <div class="receipt-row">
                                <div class="receipt-label">Trạng thái</div>
                                <div class="receipt-value">@Model.TrangThai</div>
                            </div>
                            
                            <div class="receipt-row">
                                <div class="receipt-label">Khách hàng</div>
                                <div class="receipt-value">@Model.NguoiBan.TenCuaHang</div>
                            </div>
                            
                            <div class="receipt-row">
                                <div class="receipt-label">Mã ví</div>
                                <div class="receipt-value">W-@Model.MaNguoiBan.ToString("D6")</div>
                            </div>
                            
                            @*@if (!string.IsNullOrEmpty(Model.PhuongThucThanhToan))
                            {
                                <div class="receipt-row">
                                    <div class="receipt-label">Phương thức</div>
                                    <div class="receipt-value">@Model.PhuongThucThanhToan</div>
                                </div>
                            }*@
                            
                            @if (Model.DonHang != null)
                            {
                                <div class="receipt-row">
                                    <div class="receipt-label">Mã đơn hàng</div>
                                    <div class="receipt-value">#@Model.DonHang.MaDonHang</div>
                                </div>
                            }
                            
                            <div class="receipt-total">
                                <div class="total-label">Số tiền</div>
                                <div class="total-value @amountClass">
                                    @amountPrefix@string.Format("{0:N0} VNĐ", Math.Abs(Model.SoTien))
                                </div>
                            </div>
                        </div>
                        
                        <div class="receipt-footer">
                            <div class="receipt-barcode">
                                <img src="https://barcode.tec-it.com/barcode.ashx?data=@Model.MaGhiChep&code=Code128&multiplebarcodes=false&translate-esc=false&unit=Fit&dpi=96&imagetype=Gif&rotation=0&color=%23000000&bgcolor=%23ffffff&codepage=Default&qunit=Mm&quiet=0" alt="Barcode">
                            </div>
                            <div class="receipt-message">
                                Cảm ơn bạn đã sử dụng dịch vụ của chúng tôi!
                            </div>
                        </div>
                    </div>
                    
                    <!-- Thông tin trạng thái và hướng dẫn -->
                    @if (Model.LoaiGiaoDich == "Rút tiền" && Model.TrangThai == "Đang xử lý")
                    {
                        <div class="card status-card">
                            <div class="card-header bg-warning text-dark">
                                <i class="fas fa-info-circle mr-1"></i> Đang xử lý rút tiền
                            </div>
                            <div class="card-body">
                                <p>Yêu cầu rút tiền của bạn đang được xử lý. Thông thường sẽ mất 1-2 ngày làm việc để hoàn tất giao dịch.</p>
                                <p class="mb-0">Số tiền sẽ được chuyển vào tài khoản ngân hàng của bạn trong thời gian sớm nhất.</p>
                            </div>
                        </div>
                    }
                    else if (Model.LoaiGiaoDich == "Nạp tiền ví" && Model.TrangThai == "Thành công")
                    {
                        <div class="card status-card">
                            <div class="card-header bg-success text-white">
                                <i class="fas fa-check-circle mr-1"></i> Nạp tiền thành công
                            </div>
                            <div class="card-body">
                                <p>Số tiền đã được nạp thành công vào ví của bạn. Bạn có thể sử dụng số dư này để thanh toán các giao dịch hoặc đặt cọc cho các đơn hàng.</p>
                                <p class="mb-0">Số dư hiện tại: <strong>@string.Format("{0:N0} VNĐ", ViewBag.SoDuHienTai)</strong></p>
                            </div>
                        </div>
                    }
                    else if (Model.LoaiGiaoDich == "Nạp tiền ví" && Model.TrangThai == "Đang xử lý")
                    {
                        <div class="card status-card">
                            <div class="card-header bg-warning text-dark">
                                <i class="fas fa-clock mr-1"></i> Đang xử lý nạp tiền
                            </div>
                            <div class="card-body">
                                <p>Yêu cầu nạp tiền của bạn đang được xử lý. Số dư sẽ được cập nhật sau khi thanh toán được xác nhận.</p>
                                <p class="mb-0">Vui lòng kiểm tra lại sau.</p>
                            </div>
                        </div>
                    }
                    else if (Model.TrangThai == "Thành công")
                    {
                        <div class="card status-card">
                            <div class="card-header bg-success text-white">
                                <i class="fas fa-check-circle mr-1"></i> Giao dịch thành công
                            </div>
                            <div class="card-body">
                                <p>Giao dịch này đã được hoàn tất thành công.</p>
                                <p class="mb-0">Thời gian hoàn tất: @Model.NgayGiaoDich.ToString("dd/MM/yyyy HH:mm:ss")</p>
                            </div>
                        </div>
                    }

                    <!-- Thông tin đối soát -->
                    <div class="card mt-3">
                        <div class="card-header bg-light">
                            <i class="fas fa-shield-alt mr-1"></i> Thông tin bảo mật
                        </div>
                        <div class="card-body">
                            <p class="small mb-0">
                                <i class="fas fa-info-circle mr-1 text-muted"></i> 
                                Mã giao dịch #@Model.MaGhiChep được xác thực trên hệ thống.
                                Biên lai điện tử này có giá trị pháp lý và có thể được sử dụng để đối soát khi cần thiết.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>